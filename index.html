<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scam Guard AI - Risk Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Prompt', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        },
                        risk: {
                            low: '#10b981',
                            medium: '#f59e0b',
                            high: '#ef4444'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f8fafc; }
        .transition-all { transition: all 300ms cubic-bezier(0.4,0,0.2,1); }
    </style>
</head>

<body onload="checkAPIServer()" class="min-h-screen flex flex-col text-slate-800">

<!-- HEADER -->
<div class="bg-slate-900 text-white py-2 px-4 text-xs font-medium">
    <div class="max-w-4xl mx-auto flex justify-between items-center">
        <div class="flex items-center space-x-4">
            <div class="flex items-center">
                <span id="apiStatusDot" class="w-2 h-2 rounded-full bg-gray-500 mr-2"></span>
                <span>API Server: <span id="apiStatusText" class="opacity-75">Checking...</span></span>
            </div>
            <div class="flex items-center">
                <span id="aiStatusDot" class="w-2 h-2 rounded-full bg-gray-500 mr-2"></span>
                <span>AI Engine: <span id="aiStatusText" class="opacity-75">Waiting...</span></span>
            </div>
        </div>
        <div class="opacity-50">Dev Mode</div>
    </div>
</div>

<main class="flex-grow container mx-auto px-4 py-8 max-w-2xl">

<!-- INPUT -->
<div class="bg-white rounded-2xl shadow-xl border border-slate-100 p-6 md:p-8">
    <label class="block font-semibold mb-3 text-lg">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏á‡∏™‡∏±‡∏¢</label>
    <textarea id="inputText"
        onkeydown="handleEnter(event)"
        class="w-full bg-slate-50 border p-4 rounded-xl focus:ring-2 focus:ring-brand-500 resize-none"
        rows="5"
        placeholder="‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö..."></textarea>

    <div class="mt-6">
        <button id="analyzeBtn" onclick="analyzeText()"
            class="w-full bg-brand-600 hover:bg-brand-700 text-white font-bold py-4 rounded-xl shadow-lg transition-all">
            üîç ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
        </button>
    </div>
</div>

<!-- RESULT -->
<div id="resultSection" class="mt-8 hidden opacity-0 translate-y-4 transition-all">

<div id="verdictCard" class="bg-white rounded-2xl shadow-lg border-l-8 mb-6">
    <div class="p-6 md:p-8">

        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-sm font-bold text-slate-400 mb-1">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h2>
                <h3 id="verdictTitle" class="text-3xl font-extrabold"></h3>
            </div>
            <div class="bg-slate-100 px-4 py-2 rounded-lg">
                <span id="scoreText" class="text-2xl font-bold"></span>%
            </div>
        </div>

        <div class="w-full bg-slate-200 rounded-full h-3 mb-6">
            <div id="scoreFill" class="h-full rounded-full transition-all duration-1000"></div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="bg-slate-50 p-4 rounded-xl">
                <p class="text-xs text-slate-500 mb-1">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö (Pattern)</p>
                <p id="patternText" class="font-semibold text-slate-700"></p>
            </div>
            <div class="bg-slate-50 p-4 rounded-xl">
                <p class="text-xs text-slate-500 mb-1">‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•</p>
                <p id="timeText" class="font-bold text-lg"></p>
            </div>
        </div>

        <div class="bg-brand-50 p-5 rounded-xl border">
            <p class="font-bold mb-1">üí° ‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏Ç‡∏≠‡∏á AI</p>
            <p id="analysisText" class="text-sm leading-relaxed"></p>
        </div>
    </div>
</div>

</div>
</main>

<script>
const API_URL = 'https://maranda-unhoed-unpervertedly.ngrok-free.dev';

function handleEnter(e){
    if(e.key==='Enter' && !e.shiftKey){
        e.preventDefault();
        analyzeText();
    }
}

async function checkAPIServer(){
    try{
        const r = await fetch(`${API_URL}/`);
        if(r.ok){
            apiStatusDot.className='w-2 h-2 rounded-full bg-green-500 mr-2';
            apiStatusText.innerText='Online';
        }
    }catch{}
}

async function analyzeText(){
    const text = inputText.value.trim();
    if(!text) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°");

    const start = performance.now();
    const r = await fetch(`${API_URL}/analyze`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({text})
    });
    const data = await r.json();
    const duration=((performance.now()-start)/1000).toFixed(2);
    displayResult(data,duration);
}

/* ===========================
   DISPLAY LOGIC (‡πÅ‡∏Å‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ)
   =========================== */
function displayResult(data,duration){
    const score = parseInt(String(data.scam_score).replace('%',''));

    let border,color,bar;
    if(score>=81){border='border-risk-high';color='text-risk-high';bar='bg-red-500';}
    else if(score>=61){border='border-risk-medium';color='text-risk-medium';bar='bg-orange-500';}
    else{border='border-risk-low';color='text-risk-low';bar='bg-green-500';}

    verdictCard.className=`bg-white rounded-2xl shadow-lg border-l-8 mb-6 ${border}`;
    verdictTitle.className=`text-3xl font-extrabold ${color}`;
    verdictTitle.innerText=data.verdict;

    scoreText.innerText=score;
    scoreText.className=`text-2xl font-bold ${color}`;

    scoreFill.className=`h-full rounded-full transition-all duration-1000 ${bar}`;
    scoreFill.style.width='0%';

    patternText.innerText = (data.pattern_detected||[]).length
        ? data.pattern_detected.join(' ‚Ä¢ ')
        : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢';

    analysisText.innerText=data.analysis_th;
    timeText.innerText=`${duration} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;

    resultSection.classList.remove('hidden');
    setTimeout(()=>{
        resultSection.classList.remove('opacity-0','translate-y-4');
        scoreFill.style.width=`${score}%`;
    },50);
}
</script>
</body>
</html>
